function close_data(){data_container.open=!1,$(dbody).removeClass("data_mode")}function open_data(){data_container.open=!0,$(dbody).addClass("data_mode")}function open_floating(e){close_floatings(),$(e).addClass("on"),e.list.open=!0,$(e.list).addClass("open")}function close_floatings(){$(indicators_bt).removeClass("on"),$(areas_bt).removeClass("on"),$(area_filters).removeClass("open"),$(category_filter).removeClass("open"),area_filters.open=!1,category_filter.open=!1}function check_filters(){CATEG.id>0||AREA.id>0?$(clear_filters).removeClass("off"):$(clear_filters).addClass("off")}function open_layers(){layers.open=!0,$(dbody).addClass("layers_mode"),resize_map(animate2)}function close_layers(){layers.open=!1,$(dbody).removeClass("layers_mode"),resize_map(animate2)}function close_layer(e){e.open=!1,$(e).removeClass("open")}function open_layer(e){reset_layers(),e.open=!0,$(e).addClass("open")}function create_layer(e){var a=elem("li",{id:"layer_"+e.id,trg:layers_list});$(a).addClass("layer").addClass("animate"),a.open=!1,a.off=!1,a.obj=e,layers_list.prepend(a);var t=elem("div",{trg:a});$(t).addClass("lb1").addClass("animate1").html(e.ano),a.label1=t;var r=elem("div",{trg:a});$(r).addClass("lb2").addClass("animate1").html(e.nome),a.label2=r;var s=elem("div",{trg:a});$(s).addClass("eye").addClass("animate1").addClass("icon15").append(icons.eye).on("click",function(){this.layer.off?(this.layer.off=!1,$(this.layer).removeClass("off"),toggle_layer(this.obj,!0)):(this.layer.off=!0,$(this.layer).addClass("off"),toggle_layer(this.obj,!1),this.layer.open&&close_layer(this.layer))}),s.layer=a,s.obj=e;var i=elem("div",{trg:a});$(i).addClass("arrow").addClass("animate1").addClass("icon15").append(icons.down);var l=elem("div",{trg:a});$(l).addClass("handle").addClass("icon15").append(icons.hamburguer);var n=elem("div",{trg:a});$(n).addClass("layer_content").addClass("animate2"),a.content=n;var o=elem("div",{trg:a});$(o).addClass("layer_hit").on("click",function(){this.layer.open?close_layer(this.layer):this.layer.off||open_layer(this.layer)}),o.layer=a;var c='"[ANO]"="'+e.ano+'"';console.log("ms_filter"),console.log(c);var d=L.tileLayer.wms("http://maps.lapig.iesa.ufg.br/ows?",{layers:e.id,format:"image/png",transparent:!0,width:512,height:512,srs:"EPSG:900913",MSFILTER:c,updateWhenIdle:!0});map.addLayer(d),d.obj=e,d.layer=a,map_layers.push(d),d.setZIndex(map_layers.length),$(layers_list).sortable("refresh")}function remove_layer(e){$(map_layers).each(function(a,t){t.obj==e&&($(t.layer).remove(),t.layer=null,map.removeLayer(t),map_layers.splice(map_layers.indexOf(t),1),t=null)})}function toggle_layer(e,a){$(map_layers).each(function(t,r){r.obj==e&&(a?map.addLayer(r):map.removeLayer(r))})}function search_indicator(e){var a;return $(DATA.list).each(function(t,r){e.region==r.region&&e.regionType==r.regionType&&e.id==r.id&&(a=r)}),a}function normalize_categs(e){var a=[];return $(e).each(function(e,t){a.push(removeAccents(t.toLowerCase()))}),a}function get_area_label(e,a){var t="";if("brasil"==e)t=language.brasil[lang].toUpperCase();else switch(convert_lb(e)){case"Estados":$(AREA.json.Estados).each(function(e,r){a==r.UF&&(t=r.ESTADO)});case"Municipios":case"Biomas":case"Regioes":case"Bacias":}return t}function convert_lb(e){switch(e){case"estado":return"Estados";case"municipio":return"Municipios";case"bioma":return"Biomas";case"regiao":return"Regioes";case"bacia":return"Bacias"}}function create_indicator(e){var a=elem("li",{trg:indicators_list,cls:"indicator animate2"});a.open=!1,a.selected=!1,a.id=e.id,a.nome=e.nome,a.descricao=e.descricao,a.categ=normalize_categs(e.categ),a.unidade=e.unidade,a.ano=e.ano.reverse(),a.valor=e.valor.reverse(),a.tipo=e.tipo,a.val_id=0,DATA.list.push(a);var t=elem("div",{trg:a,cls:"icon check animate1 icon20"});$(t).append(icons.cCheckFull),$(t).on("click",function(){toggle_check_indicator(this.indicator)}),t.indicator=a;var r=elem("div",{trg:a,cls:"hit"});$(r).on("click",function(){toggle_open_indicator(this.indicator)}),r.indicator=a;var s=elem("label",{trg:a,cls:"animate1 title"}),i=(elem("span",{trg:s,html:e.nome}),elem("span",{trg:s,html:" | "}));a.area_label=elem("span",{trg:s,html:"BRASIL"}),i=elem("span",{trg:s,html:" | "});var l=elem("span",{trg:s});a.year=l,a.ano.length>1?$(l).addClass("plus").html(a.ano[0]+" (+)"):$(l).html(a.ano[0]);var n=elem("label",{trg:a,cls:"animate1 data"});$(n).html(format_number(a.valor[0])+" "+e.unidade),a.data=n;var o=elem("div",{trg:a,cls:"icon arrow animate1 icon15"});$(o).append(icons.down);var c=elem("div",{trg:a,cls:"data_box"});a.data_box=c;var d=elem("div",{trg:c,cls:"data_description"});$(d).html(e.descricao);var _=elem("div",{trg:c,cls:"data_box_bts"}),g=elem("select",{trg:_,cls:"data_select animate2"});$(g).attr("tabindex",-1).on("change",function(){var e=$(this).val();this.indicator.val_id=e,$(this.indicator.data).html(format_number(this.indicator.valor[e])+" "+a.unidade),$(this.indicator.year).html(a.ano[e]+" (+)")}),g.indicator=a;var m=elem("div",{trg:_,cls:"data_select_icon icon15"});$(m).append(icons.down),$(a.ano).each(function(e,t){var r=elem("option",{trg:g,cls:"data_opt"});$(r).html(t).attr("value",e),e==a.ano[0]&&$(r).attr("selected","selected")});var p=elem("div",{trg:_,cls:"data_add animate2"});$(p).on("click",function(){toggle_check_indicator(this.indicator)}),p.indicator=a,a.data_add=p;var f=(elem("span",{trg:p,cls:"lb_off lg_add_to_report",html:"INCLUIR "}),elem("span",{trg:p,cls:"lb_on lg_remove_from_report",html:" REMOVER"}),elem("div",{trg:p,cls:"icon icon15 animate2"}));$(f).append(icons.plus)}function toggle_open_indicator(e){e.open?close_indicator(e):(reset_indicators(),open_indicator(e))}function open_indicator(e){e.open=!0,$(e).addClass("open").css({height:130+$(e.data_box).height()})}function close_indicator(e){e.open=!1,$(e).removeClass("open").css({height:""})}function reset_indicators(){$(DATA.list).each(function(e,a){a.open&&close_indicator(a)})}function reset_layers(){$(map_layers).each(function(e,a){close_layer(a.layer)})}function set_indicator(e,a){e.selected=a,a?$(e).addClass("selected"):$(e).removeClass("selected")}function toggle_check_indicator(e){e.selected?(set_indicator(e,!1),blink("out")):(set_indicator(e,!0),blink("in")),update_report(e)}function update_report(e){if(e.selected){var a={id:e.id,ano:e.ano[e.val_id],valor:e.valor[e.val_id],unidade:e.unidade,nome:e.nome};create_layer(a),report.list.push(a)}else console.log("remove"),$(report.list).each(function(a,t){t.id==e.id&&(remove_layer(t),report.list.splice(a,1),t=null)});console.log("update_report: ",report),sessionStorage.setItem("report",JSON.stringify(report)),count_report(),check_layers()}function check_layers(){report.list.length>0?($(msg_layers).hide(),$(msg_report).hide(),$(layers_list).show(),$(sort_layers_msg).show()):($(msg_layers).show(),$(msg_report).show(),$(layers_list).hide(),$(sort_layers_msg).hide())}function blink(e){$(report_bt).addClass("blink "+e),$(layers_bt).addClass("blink "+e),setTimeout(function(){$(report_bt).removeClass("blink "+e),$(layers_bt).removeClass("blink "+e)},animate2)}function check_session_report(){var e=sessionStorage.getItem("report");e&&(report=JSON.parse(e)),report.list.length>0&&($(report.list).each(function(e,a){create_layer(a)}),blink("in"))}function check_indicators_on(){$(report.list).each(function(e,a){$(DATA.list).each(function(e,t){a.id==t.id&&set_indicator(t,!0)})})}function count_report(){$(layers_counter).html(report.list.length),$(report_bt_counter).html(report.list.length)}function create_categ_filter(e,a,t){var r=elem("li",{trg:category_filter_ul});$(r).addClass("filter").addClass("animate1").addClass(t?" selected":"").html(language[a][lang]).on("click",function(){set_categ_filter(this)}),r.ID=e,r.categ=a,r.lb=language[a][lang],CATEG.itens.push(r)}function set_categ_filter(e){CATEG.id=e.ID,$(CATEG.itens).each(function(a,t){a==e.ID?$(t).addClass("selected"):$(t).removeClass("selected")}),$(DATA.list).each(function(a,t){e.ID>0&&t.categ.indexOf(e.categ)<0?$(t).addClass("hide"):$(t).removeClass("hide")}),$(indicators_bt_lb2).html(e.lb),close_floatings(),check_filters()}function create_area_list(e,a,t){var r=elem("div",{trg:area_filters,cls:"floating_list list_container animate2"});area_filter_li(language[a.toLowerCase()][lang],e,r,!1,!1);var s=elem("div",{trg:r,cls:"floating_list_back"});$(s).on("click",function(){$(this.container).removeClass("show")}),s.container=r;var i=(elem("div",{trg:s,cls:"animate1 icon icon15",apd:icons.left}),elem("label",{trg:s,cls:"animate1",html:language.back[lang]}),elem("ul",{trg:r,cls:"floating_list list_content"}));switch($(i).css({paddingTop:80}),a){case"Estados":sort_on(t,"ESTADO",!1,!1),$(t).each(function(e,a){area_filter_li(a.ESTADO,i,!1,"estado",a.UF)});break;case"Municipios":break;case"Biomas":sort_on(t,"BIOMA",!1,!1),$(t).each(function(e,a){area_filter_li(a.BIOMA,i,!1,"bioma",a.BIOMA)});break;case"Regioes":sort_on(t,"nome",!1,!1),$(t).each(function(e,a){area_filter_li(a.nome,i,!1,"regiao",a.nome)});break;case"Bacias":}}function area_filter_li(e,a,t,r,s){var i=elem("li",{trg:a});if($(i).addClass("filter").addClass("animate1").html(e).on("click",function(){this.list?call_area_list(this.list):set_area_filter(this)}),t){var l=elem("div",{trg:i,cls:"go icon15"});$(l).append(icons.right)}return i.lb=e,i.list=t,i.regionType=r,i.region=s,AREA.itens.push(i),i.ID=AREA.itens.indexOf(i),i}function call_area_list(e){$(AREA.current_list).removeClass("show"),$(e).addClass("show"),AREA.current_list=e}function set_area_filter(e){console.log("set_area_filter: "+e.lb);var a=e.ID;AREA.id=a,$(AREA.itens).each(function(e,t){e==a?$(t).addClass("selected"):$(t).removeClass("selected")}),$(areas_bt_lb2).html(e.lb),close_floatings(),check_filters();var t="data/lista";"brasil"!=e.regionType&&(t+="_"+e.regionType),"brasil"!=e.region&&(t+="_"+e.region),t+=".json",ajax(t,DATA,"update_indicators_data",[e.regionType,e.region])}function convert_lang(e){switch(e){case"_pt":return"pt-bt";case"_en":return"en-us"}}console.log("--- module: map.js"),set("data_bt"),set("data_container"),set("indicators_bt"),set("areas_bt"),set("clear_filters"),set("filters"),set("category_filter"),set("area_filters"),set("report_bt"),set("map_report"),set("report_indicators"),$(dbody).addClass("data_mode"),data_container.open=!0,$(data_bt).on("click",function(){data_container.open?close_data():open_data(),resize_map(animate2)}),$(indicators_bt).on("click",function(){this.list.open?close_floatings():open_floating(this)}),$(clear_filters).on("click",function(){close_floatings(),set_area_filter(area_brasil),set_categ_filter(CATEG.itens[0])}),$(areas_bt).on("click",function(){this.list.open?close_floatings():open_floating(this)}),indicators_bt.list=category_filter,areas_bt.list=area_filters;var layers=elem("div",{trg:dbody});$(layers).attr("id","layers").addClass("l1").addClass("animate2"),layers.open=!1;var layers_bt=elem("div",{trg:map_controls});$(layers_bt).attr("id","layers_bt").addClass("animate1").on("click",function(){open_layers()});var icon1=elem("div",{id:"layers_bt_icon1",trg:layers_bt});$(icon1).addClass("layer_icon").addClass("animate1").addClass("icon25").append(icons.layers);var label=elem("span",{cls:"lg_layers",id:"layers_bt_label",trg:layers_bt,html:language.layers[lang]}),layers_counter=elem("span",{id:"layers_counter",cls:"counter animate1",trg:layers_bt}),layers_top=elem("div",{id:"layers_top",cls:"animate1",trg:layers});$(layers_top).on("click",function(e,a){close_layers()});var icon2=elem("div",{id:"layers_top_icon",cls:"layer_bt_icon",trg:layers_top});$(icon2).addClass("layer_icon").addClass("animate1").addClass("icon25").append(icons.layers);var label2=elem("div",{id:"layers_top_label",trg:layers_top,html:language.layers[lang]}),icon3=elem("div",{id:"layers_top_x",cls:"icon15 layer_bt_icon",trg:layers_top});$(icon3).append(icons.right);var layers_list=elem("ul",{id:"layers_list",cls:"",trg:layers});$(layers_list).sortable({axis:"y",handle:".handle",revert:100,scrollSensitivity:10,scrollSpeed:20,update:function(e,a){var t=$(layers_list).sortable("toArray");$(t).each(function(e,a){var r=get(a);$(map_layers).each(function(a,s){s.obj==r.obj&&s.setZIndex(t.length-e)})})}}).disableSelection();var msg_layers=elem("div",{cls:"no_indicators_msg",trg:layers});$(msg_layers).html(language.no_indicators[lang]);var msg_report=elem("li",{cls:"no_indicators_msg",trg:report_indicators});$(msg_report).html(language.no_indicators[lang]);var sort_layers_msg=elem("div",{id:"sort_layers_msg",trg:layers});$(sort_layers_msg).html(language.sort_msg[lang]),set("clear_report_bt"),$(clear_report_bt).on("click",function(){$(DATA.list).each(function(e,a){a.selected&&toggle_check_indicator(a)})});var DATA={};set("indicators_list"),DATA.list=[],DATA.categs=["all"],DATA.create_indicators_list=function(){indicators_list.innerHTML="",category_filter_ul.innerHTML="",$(DATA.json).each(function(e,a){create_indicator(a),$(a.categ).each(function(e,a){var t=removeAccents(a.toLowerCase());DATA.categs.indexOf(t)<0&&DATA.categs.push(t)})}),CATEG.itens=[],$(DATA.categs).each(function(e,a){var t=removeAccents(a.toLowerCase());create_categ_filter(e,t,!1)}),set_categ_filter(CATEG.itens[0]),check_indicators_on()},DATA.update_indicators_data=function(e,a){console.log("update_indicators_data!!"),$(DATA.list).each(function(t,r){$(r.area_label).html(get_area_label(e,a))})},set("report_container"),$(report_bt).on("click",function(){report_container.open?(report_container.open=!1,$(report_container).removeClass("open")):(report_container.open=!0,$(report_container).addClass("open"))});var report={list:[]};set("category_filter"),set("category_filter_ul"),set("indicators_bt_lb2");var CATEG={};CATEG.itens=[],CATEG.id=0,set("area_filters"),set("area_main_list"),set("area_main_ul"),set("areas_bt_lb2");var AREA={};AREA.itens=[],AREA.id=0;var d,m,area_brasil;AREA.load_floating_lists=function(){AREA.current_list=area_main_ul,area_brasil=area_filter_li(language.brasil[lang],area_main_ul,!1,"brasil","brasil");for(d in AREA.json){var e=removeAccents(d);create_area_list(area_main_ul,e,AREA.json[d],!0)}var a="data/lista.json";ajax(a,DATA,"create_indicators_list",[]),set_area_filter(area_brasil)},ajax("data/regions.json",AREA,"load_floating_lists",[]),initMap(),check_session_report(),count_report(),check_filters(),check_layers(),console.log("session_report: ",report);